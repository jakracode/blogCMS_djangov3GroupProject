{% load static %}
<!DOCTYPE html>
<html lang="km" class="scroll-smooth">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ post.title }} | 4\null Freelancer</title>
  {% with description=post.content|striptags|truncatechars:160 %}
  <meta name="description" content="{{ description }}" />
  <link rel="canonical" href="{{ request.build_absolute_uri }}" />

  <!-- Open Graph -->
  <!-- SEO Meta Tags -->

  <meta property="og:type" content="article" />
  <meta property="og:title" content="{{ post.title }}" />
  <meta property="og:description" content="{{ description }}" />
  <meta property="og:url" content="{{ request.build_absolute_uri }}" />
  {% if post.featured_image %}
  <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.featured_image.url }}" />
  {% endif %}
  <meta property="article:published_time" content="{{ post.date_created|date:'c' }}" />
  <meta property="article:modified_time" content="{{ post.date_updated|date:'c' }}" />
  <meta property="article:author" content="{{ post.author|default:'4\\null' }}" />
  {% if post.tags %}
  <meta property="article:tag" content="{{ post.tags }}" />
  {% endif %}

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ post.title }}" />
  <meta name="twitter:description" content="{{ description }}" />
  {% if post.featured_image %}
  <meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.featured_image.url }}" />
  {% endif %} {% endwith %}

  <!-- Khmer Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;500;600;700&family=Battambang:wght@700;900&display=swap"
    rel="stylesheet" />

  <link rel="stylesheet" href="{% static 'main/PostLayout.css' %}" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            kantumruy: ["Kantumruy Pro", "sans-serif"],
            battambang: ["Battambang", "sans-serif"],
          },
        },
      },
    };
  </script>
  <style>
    /* Theme Variables */
    :root {
      --bg-primary: linear-gradient(to bottom right,
          rgb(17, 24, 39),
          rgb(24, 24, 27),
          rgb(0, 0, 0));
      --bg-nav: rgba(0, 0, 0, 0.4);
      --bg-card: rgba(255, 255, 255, 0.05);
      --border-color: rgba(255, 255, 255, 0.1);
      --text-primary: rgb(255, 255, 255);
      --text-secondary: rgb(209, 213, 219);
      --text-muted: rgb(156, 163, 175);
    }

    .light-mode {
      --bg-primary: linear-gradient(to bottom right,
          rgb(241, 245, 249),
          rgb(226, 232, 240),
          rgb(203, 213, 225));
      --bg-nav: rgba(255, 255, 255, 0.8);
      --bg-card: rgba(255, 255, 255, 0.9);
      --border-color: rgba(0, 0, 0, 0.1);
      --text-primary: rgb(15, 23, 42);
      --text-secondary: rgb(51, 65, 85);
      --text-muted: rgb(100, 116, 139);
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: background 0.3s ease, color 0.3s ease;
    }

    .theme-card {
      background: var(--bg-card);
      border-color: var(--border-color);
    }

    .theme-nav {
      background: var(--bg-nav);
      border-color: var(--border-color);
    }

    .theme-text {
      color: var(--text-primary);
    }

    .theme-text-secondary {
      color: var(--text-secondary);
    }

    .theme-text-muted {
      color: var(--text-muted);
    }

    /* Toggle Switch Styles */
    .theme-toggle {
      position: relative;
      width: 60px;
      height: 30px;
      background: rgba(100, 116, 139, 0.3);
      border-radius: 30px;
      cursor: pointer;
      transition: background 0.3s;
      border: 2px solid rgba(148, 163, 184, 0.2);
    }

    .theme-toggle:hover {
      background: rgba(100, 116, 139, 0.4);
    }

    .theme-toggle-slider {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 22px;
      height: 22px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .light-mode .theme-toggle-slider {
      transform: translateX(30px);
      background: #fbbf24;
    }

    .theme-toggle-icon {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
      transition: opacity 0.3s;
    }

    .theme-toggle-icon.moon {
      left: 6px;
      opacity: 1;
    }

    .theme-toggle-icon.sun {
      right: 6px;
      opacity: 0.3;
    }

    .light-mode .theme-toggle-icon.moon {
      opacity: 0.3;
    }

    .light-mode .theme-toggle-icon.sun {
      opacity: 1;
    }

    /* Light mode text overrides - stronger contrast for readability */
    .light-mode .text-white {
      color: rgb(15, 23, 42) !important;
    }

    .light-mode .text-gray-200,
    .light-mode .text-gray-300 {
      color: rgb(30, 41, 59) !important;
    }

    .light-mode .text-gray-400 {
      color: rgb(71, 85, 105) !important;
    }

    .light-mode .text-gray-500 {
      color: rgb(100, 116, 139) !important;
    }

    .light-mode .text-cyan-300,
    .light-mode .text-cyan-400 {
      color: rgb(14, 116, 144) !important;
    }

    /* Light mode card backgrounds */
    .light-mode .bg-white\/5,
    .light-mode .bg-white\/10 {
      background: rgba(255, 255, 255, 0.9) !important;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* Light mode CKEditor content */
    .light-mode .ck-content {
      color: rgb(30, 41, 59) !important;
    }

    .light-mode .ck-content p,
    .light-mode .ck-content li,
    .light-mode .ck-content span,
    .light-mode .ck-content strong,
    .light-mode .ck-content b,
    .light-mode .ck-content h1,
    .light-mode .ck-content h2,
    .light-mode .ck-content h3,
    .light-mode .ck-content h4,
    .light-mode .ck-content h5,
    .light-mode .ck-content h6 {
      color: rgb(30, 41, 59) !important;
    }

    /* CKEditor image centering */
    .ck-content img {
      display: block;
      margin-left: auto;
      margin-right: auto;
      max-width: 100%;
      height: auto;
    }

    .ck-content figure {
      text-align: center;
      margin: 1.5rem auto;
    }

    .ck-content figure img {
      display: inline-block;
    }

    /* Light mode borders */
    .light-mode .border-white\/10 {
      border-color: rgba(0, 0, 0, 0.1) !important;
    }
  </style>
</head>

<body class="min-h-screen transition-all duration-300">
  <!-- Fixed Glass Navbar -->
  <nav class="fixed top-0 left-0 right-0 z-50 backdrop-blur-xl theme-nav border-b transition-all duration-300 relative">
    <div class="max-w-7xl mx-auto px-6 py-3 flex justify-between items-center">
      <a href="/"
        class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent font-battambang truncate max-w-[200px] md:max-w-none">
        4\null Freelancer
      </a>

      <!-- Desktop Menu -->
      <div class="hidden md:flex items-center space-x-6">
        <div class="flex space-x-10 font-kantumruy theme-text-secondary">
          <a href="/" class="hover:text-cyan-400 transition">á‘áŸ†á–áŸášáŠá¾á˜</a>
          <a href="{% url 'blog_list' %}" class="text-cyan-400 font-semibold">á”áŸ’á›á€áŸ‹</a>
          <a href="#" class="hover:text-cyan-400 transition">á‚á˜áŸ’ášáŸ„á„</a>
          <a href="#" class="hover:text-cyan-400 transition">á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„</a>
        </div>
        <!-- Theme Toggle -->
        <button class="theme-toggle js-theme-toggle" aria-label="Toggle theme">
          <span class="theme-toggle-icon moon">ğŸŒ™</span>
          <span class="theme-toggle-icon sun">â˜€ï¸</span>
          <div class="theme-toggle-slider"></div>
        </button>
      </div>

      <!-- Mobile Menu Button -->
      <div class="md:hidden flex items-center gap-4">
        <!-- Theme Toggle Mobile -->
        <button class="theme-toggle js-theme-toggle" aria-label="Toggle theme" style="transform: scale(0.8);">
          <span class="theme-toggle-icon moon">ğŸŒ™</span>
          <span class="theme-toggle-icon sun">â˜€ï¸</span>
          <div class="theme-toggle-slider"></div>
        </button>
        <button id="mobile-menu-btn" class="text-cyan-400 focus:outline-none">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu Dropdown -->
    <div id="mobile-menu" class="hidden md:hidden px-6 pb-6 pt-2 border-t border-gray-700/50">
      <div class="flex flex-col space-y-4 font-kantumruy theme-text-secondary mt-4 text-center">
        <a href="/" class="hover:text-cyan-400 transition py-2 block">á‘áŸ†á–áŸášáŠá¾á˜</a>
        <a href="{% url 'blog_list' %}" class="text-cyan-400 font-semibold py-2 block">á”áŸ’á›á€áŸ‹</a>
        <a href="#" class="hover:text-cyan-400 transition py-2 block">á‚á˜áŸ’ášáŸ„á„</a>
        <a href="#" class="hover:text-cyan-400 transition py-2 block">á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <article class="pt-32 pb-20 px-6">
    <div class="max-w-4xl mx-auto">
      <!-- Back Link -->
      <a href="{% url 'blog_list' %}"
        class="inline-flex items-center gap-2 text-cyan-400 hover:text-cyan-300 transition font-kantumruy mb-10 group">
        â† ááŸ’ášá¡á”áŸ‹á‘áŸ…á”á‰áŸ’á‡á¸á¢ááŸ’áá”á‘
      </a>

      <!-- Post Header -->
      <header class="mb-12">
        <h1 class="text-4xl md:text-6xl font-extrabold font-battambang leading-tight theme-text">
          {{ post.title }}
        </h1>

        <div class="flex flex-wrap items-center gap-4 mt-6 theme-text-muted font-kantumruy text-sm">
          <span class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
            </svg>
            {{ post.author.get_full_name|default:"4\null" }}
          </span>
          <span>â€¢</span>
          <span class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd"
                d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h.01a1 1 0 100-2H6zm2 0a1 1 0 011-1h2a1 1 0 110 sensorial 2H9a1 1 0 01-1-1zm-1 4a1 1 0 100 2h6a1 1 0 100-2H7z"
                clip-rule="evenodd" />
            </svg>
            {{ post.date_created|date:"d/m/Y" }}
          </span>
          {% if post.date_updated != post.date_created %}
          <span>â€¢ á€áŸ‚á”áŸ’ášáŸ‚ááŸ’á„áŸƒá‘á¸ {{ post.date_updated|date:"d/m/Y" }}</span>
          {% endif %}
        </div>
      </header>

      <!-- Featured Image -->
      {% if post.featured_image %}
      <div class="my-12 -mx-6 md:mx-0 rounded-2xl overflow-hidden shadow-2xl">
        <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="w-full h-auto max-h-96 object-cover" />
      </div>
      {% endif %}

      <!-- Post Content (from CKEditor) -->
      <div class="ck-content font-kantumruy theme-text-secondary">
        {{ post.content|safe }}
      </div>

      <!-- Comments Section -->
      <section class="mt-20 pt-10 border-t transition-colors" style="border-color: var(--border-color)">
        <h2 class="text-3xl font-bold font-battambang mb-10 text-cyan-400">
          á˜áá·á™áŸ„á”á›áŸ‹ ({{ total_comments }})
        </h2>

        <!-- Messages (success/error) -->
        {% if messages %}
        <div class="mb-8 space-y-3">
          {% for message in messages %}
          <div
            class="p-4 rounded-xl font-kantumruy border {% if message.tags == 'success' %} bg-green-900/30 border-green-500/50 text-green-300 {% elif message.tags == 'error' %} bg-red-900/30 border-red-500/50 text-red-300 {% else %} bg-cyan-900/30 border-cyan-500/50 text-cyan-300 {% endif %}">
            {{ message }}
          </div>
          {% endfor %}
        </div>
        {% endif %}
        <!-- Comment List -->
        {% if shown_comments %}
        <div class="space-y-6" id="comments">
          {% for comment in shown_comments %}
          <div class="theme-card backdrop-blur-md rounded-2xl p-6 hover:border-cyan-500/30 transition"
            style="border: 1px solid var(--border-color)">
            <div class="flex items-center justify-between mb-3">
              <h4 class="font-bold text-lg font-kantumruy text-cyan-400">
                {{ comment.name }}
              </h4>
              <span class="text-sm theme-text-muted">{{ comment.date_created|date:"d/m/Y H:i" }}</span>
            </div>
            <p class="theme-text-secondary font-kantumruy leading-relaxed">
              {{ comment.content|linebreaks }}
            </p>
          </div>
          {% endfor %}
        </div>
        <div class="mt-6 text-center space-x-4">
          {% if has_more_comments %}
          <a href="?c={{ next_count }}#comments"
            class="px-6 py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded-full font-kantumruy inline-block">
            á”á„áŸ’á á¶á‰á˜áá·á™áŸ„á”á›áŸ‹á”á“áŸ’ááŸ‚á˜
          </a>
          {% endif %} {% if current_count > 5 %}
          <a href="?c=5#comments"
            class="px-6 py-3 bg-gray-600 hover:bg-gray-500 text-white rounded-full font-kantumruy inline-block">
            á”á„áŸ’ášá½á˜
          </a>
          {% endif %}
        </div>
        {% else %}
        <p class="text-center text-gray-500 py-12 text-xl font-kantumruy italic">
          á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á˜áá·á™áŸ„á”á›áŸ‹áá¶á˜á½á™á‘áŸáŸ” áŸá¼á˜á’áŸ’áœá¾á‡á¶á¢áŸ’á“á€áŠáŸ†á”á¼á„!
        </p>
        {% endif %}

        <!-- Comment Form -->
        <div class="mt-12 bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl p-8">
          <h3 class="text-2xl font-bold font-battambang mb-8 text-white">
            áŸášáŸáŸášá˜áá·á™áŸ„á”á›áŸ‹
          </h3>
          <form method="post" class="space-y-6 font-kantumruy">
            {% csrf_token %}
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-semibold mb-2 text-cyan-300">áˆáŸ’á˜áŸ„áŸ‡ *</label>
                <input type="text" name="name" required
                  class="w-full px-5 py-3 bg-white/10 border border-white/20 rounded-xl focus:border-cyan-500 focus:outline-none transition"
                  placeholder="áˆáŸ’á˜áŸ„áŸ‡ášá”áŸáŸ‹á¢áŸ’á“á€" />
              </div>
              <div>
                <label class="block text-sm font-semibold mb-2 text-cyan-300">á¢áŸŠá¸á˜áŸ‚á› *</label>
                <input type="email" name="email" required
                  class="w-full px-5 py-3 bg-white/10 border border-white/20 rounded-xl focus:border-cyan-500 focus:outline-none transition"
                  placeholder="email@example.com" />
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-2 text-cyan-300">á˜áá·á™áŸ„á”á›áŸ‹ *</label>
              <textarea name="content" rows="5" required
                class="w-full px-5 py-3 bg-white/10 border border-white/20 rounded-xl focus:border-cyan-500 focus:outline-none transition resize-none"
                placeholder="á…áŸ‚á€ášáŸ†á›áŸ‚á€á‚áŸ†á“á·áášá”áŸáŸ‹á¢áŸ’á“á€..."></textarea>
            </div>
            <button type="submit"
              class="px-8 py-4 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 rounded-full font-bold shadow-lg hover:shadow-cyan-500/50 transition transform hover:scale-105">
              á”á‰áŸ’á‡á¼á“á˜áá·á™áŸ„á”á›áŸ‹
            </button>
          </form>
        </div>
      </section>
    </div>
  </article>

  <!-- Footer -->
  <footer class="py-10 text-center theme-text-muted font-kantumruy text-sm border-t transition-colors duration-300"
    style="border-color: var(--border-color)">
    Â© 2025 4\null Freelancer â€¢ á”á„áŸ’á€á¾ááŠáŸ„á™ â¤ï¸ á“á·á„á€á¶á áŸ’áœáŸá‡á¶á…áŸ’ášá¾á“
  </footer>

  <!-- Theme Toggle Script -->
  <script>
    // Check for saved theme preference or default to dark
    const currentTheme = localStorage.getItem("theme") || "dark";
    if (currentTheme === "light") {
      document.body.classList.add("light-mode");
    }

    // Toggle theme (Handling multiple toggles for responsive design)
    const themeToggles = document.querySelectorAll('.js-theme-toggle');

    themeToggles.forEach(toggle => {
      toggle.addEventListener('click', function () {
        document.body.classList.toggle('light-mode');
        const theme = document.body.classList.contains('light-mode') ? 'light' : 'dark';
        localStorage.setItem('theme', theme);
      });
    });

    // Mobile Menu Toggle
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');

    if (mobileMenuBtn && mobileMenu) {
      mobileMenuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });
    }
  </script>
</body>

</html>